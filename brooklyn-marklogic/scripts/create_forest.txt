<#--
contains the template for create a marklogic forest. The forrest entity can be accessed using the ${forest} variable.
the marklogic node the forest is going to be installed on, can be accessed using ${entity}.
-->

#here we convert the name of the hostmachine to the internal id. This is a work around,
HOST_ID=$(curl --digest -u ${driver.user}:${driver.password} 'http://localhost:8001/add-forest.xqy?section=forest' | grep -i -m 1 '${driver.hostname}</option>' | grep  -Po -m1 'value=".*?"' | grep  -Po -m1 '".*?"' | tr -d '"')
echo found HOST_ID: $HOST_ID

echo Creating MarkLogic forrest
# not all forest fields are currently being passed; currently only the mandatory ones.
curl --digest -u ${driver.user}:${driver.password} "http://localhost:8001/add-forest-go.xqy"  \
   -d forest-0-forest-name=${forest.name} \
   -d forest-0-host=$HOST_ID \
   -d forest-0-updates-allowed=${forest.updatesAllowed} \
   -d forest-0-enabled=true \
   -d forest-0-rebalancer-enable=${forest.rebalancerEnabled?string} \
   -d forest-0-failover-enable=${forest.failoverEnabled?string} \
   -d forest-0-data-directory=${forest.dataDir!""} \
   -d forest-0-large-data-directory=${forest.largeDataDir!""} \
   -d forest-0-fast-data-directory=${forest.fastDataDir!""}

echo Finished creating MarkLogic forrest